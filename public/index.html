<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Desafio Landetech (Workana)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #141414;
      /* Fundo escuro */
      color: #fff;
      /* Texto branco */
      text-align: center;
      padding: 50px;
    }

    h1 {
      color: #33ff33;
      /* Verde neon */
    }

    /*input texto*/
    input {
      border: 1px solid #33ff33;
      /* Borda azul de 1px */
      border-radius: 5px;
      /* Borda arredondada */
      padding: 8px;
      /* Espaçamento interno */
      font-size: 16px;
      /* Tamanho da fonte */
      color: #fff;
      /* Cor do texto */
      background-color: #141414;
      /* Cor de fundo */
    }

    /* Estilo para os textareas */
    textarea {
      border: 1px solid #33ff33;
      /* Borda azul de 1px */
      border-radius: 5px;
      /* Borda arredondada */
      padding: 8px;
      /* Espaçamento interno */
      font-size: 16px;
      /* Tamanho da fonte */
      color: #fff;
      /* Cor do texto */
      background-color: #141414;
      /* Cor de fundo */
    }

    /* Estilo para os selects */
    select {
      border: 1px solid #33ff33;
      /* Borda azul de 1px */
      border-radius: 5px;
      /* Borda arredondada */
      padding: 8px;
      /* Espaçamento interno */
      font-size: 16px;
      /* Tamanho da fonte */
      color: #fff;
      /* Cor do texto */
      background-color: #141414;
      /* Cor de fundo */
    }

    /*data*/
    input[type=date] {
      border: .2em solid #33ff33;
      padding: .8em .9em;
      border-radius: 2em;
      color: #33ff33;


      &::-webkit-datetime-edit-text {
        color: #33ff33;
        padding: 0 0.3em;
      }

      &::-webkit-inner-spin-button {
        display: none;
      }
    }

    /* Estilo para os botões */
    button {
      background-color: #33ff33;
      /* Verde neon */
      color: #fff;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
      /* Transição suave ao passar o mouse */
      border-radius: 20px;
    }

    /* Estilo para o botão de editar */
    .editButton {
      background-color: #ffa500;
      /* Laranja */
    }

    .editButton:hover {
      background-color: #c98913;
    }

    /* Estilo para o botão de deletar */
    .deleteButton {
      background-color: #ff3333;
      /* Vermelho */
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s ease;
      /* Transição suave ao passar o mouse */
    }

    /* Efeito de hover no botão de deletar */
    .deleteButton:hover {
      background-color: #cc2222;
      /* Vermelho mais escuro */
    }

    /* Efeito de hover nos botões */
    button:hover {
      background-color: #22cc22;
      /* Verde neon mais escuro */
    }

    /* Estilo para os links */
    a {
      color: #33ff33;
      /* Verde neon */
      text-decoration: none;
      transition: color 0.3s ease;
      /* Transição suave ao passar o mouse */
    }

    /* Efeito de hover nos links */
    a:hover {
      color: #22cc22;
      /* Verde neon mais escuro */
    }

    /* Estilo para o formulário */
    form {
      margin-top: 20px;
    }

    /* Estilo para a lista de recrutadores */
    #recruitersList {
      list-style-type: none;
      padding: 0;
    }

    /* Estilo para os itens da lista */
    #recruitersList li {
      margin-bottom: 10px;
    }

    .error-message {
      color: red;
    }

    /* Estilo para o botão de deletar */
    .deleteButton {
      background-color: #ff3333;
      /* Vermelho neon */
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s ease;
      /* Transição suave ao passar o mouse */
    }

    /* Efeito de hover no botão de deletar */
    .deleteButton:hover {
      background-color: #cc2222;
      /* Vermelho neon mais escuro */
    }

    /*Para a barra de rolagem*/
    /* Estilo para a barra de rolagem */
    ::-webkit-scrollbar {
      width: 8px;
      /* Largura da barra de rolagem */
    }

    /* Estilo para a área de fundo da barra de rolagem */
    ::-webkit-scrollbar-track {
      background-color: #141414;
      /* Cor de fundo */
      border-radius: 10px;
      /* Borda arredondada */
    }

    /* Estilo para o indicador da posição atual na barra de rolagem */
    ::-webkit-scrollbar-thumb {
      background-color: #33ff33;
      /* Cor da barra de rolagem */
      border-radius: 10px;
      /* Borda arredondada */
    }

    /* Efeito de hover na barra de rolagem */
    ::-webkit-scrollbar-thumb:hover {
      background-color: #22cc22;
      /* Cor da barra de rolagem ao passar o mouse */
    }
  </style>
</head>

<body>
  <h1>Desafio Landetech (Workana)</h1>

  <!-- Formulário para adicionar recrutador -->
  <h2>Adicionar Recrutador</h2>
  <form id="addRecruiterForm">
    <label for="name">Nome:</label>
    <input type="text" id="name" name="name" required><br><br>
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br><br>
    <label for="password">Senha:</label>
    <input type="password" id="password" name="password" required><br><br>
    <button type="submit">Adicionar Recrutador</button>
  </form>
  <!--Para editar recrutaddor-->
  <h2>Editar Recrutador</h2>
  <form id="editRecruiterForm" style="display: none;">
    <label for="editName">Novo Nome:</label>
    <input type="text" id="editName" name="editName" required><br><br>
    <label for="editEmail">Novo Email:</label>
    <input type="email" id="editEmail" name="editEmail" required><br><br>
    <label for="editPassword">Nova Senha:</label>
    <input type="password" id="editPassword" name="editPassword" required><br><br>
    <button type="submit">Salvar Alterações</button>
    <button onclick="cancelEdit()">Cancelar</button>
  </form>

  <!-- Lista de recrutadores -->
  <h2>Recrutadores Cadastrados</h2>
  <ul id="recruitersList"></ul>

  <!-- Formulário para adicionar job -->
  <h2>Adicionar Job</h2>
  <form id="addJobForm">
    <label for="title">Título:</label>
    <input type="text" id="title" name="title" required><br><br>
    <label for="description">Descrição:</label>
    <textarea id="description" name="description" rows="4" required></textarea><br><br>
    <label for="start_date">Data de Início:</label>
    <input type="date" id="start_date" name="start_date" required><br><br>
    <label for="end_date">Data de Término:</label>
    <input type="date" id="end_date" name="end_date" required><br><br>
    <label for="status">Status:</label>
    <select id="status" name="status" required>
      <option value="ativo">Ativo</option>
      <option value="inativo">Inativo</option>
    </select><br><br>
    <label for="skills">Habilidades:</label>
    <input type="text" id="skills" name="skills" required><br><br>
    <label for="recruiter_id">ID do Recrutador:</label>
    <input type="number" id="recruiter_id" name="recruiter_id" required><br><br>
    <div id="errorMessages" class="error-message"></div>
    <button type="submit">Adicionar Job</button>
  </form>

  <!-- Lista de Jobs -->
  <h2>Jobs Cadastrados</h2>
  <ul id="jobsList"></ul>

  <!--Footer-->
  <br/>
  <footer>
    <p style="text-align: center; color: #ffa500;">Criado e testado por Yann Lima.</p>
  </footer>

  <script>
    // Função para carregar recrutadores
    function loadRecruiters() {
      fetch('http://localhost:3000/recruiters')
        .then(response => response.json())
        .then(data => {
          const recruitersList = document.getElementById('recruitersList');
          recruitersList.innerHTML = ''; // Limpa a lista anterior

          data.forEach(recruiter => {
            const li = document.createElement('li');
            li.innerHTML = `
               ID: ${recruiter.id} | Nome: ${recruiter.name} | Email: ${recruiter.email}
              <button class="editButton" onclick="editRecruiter(${recruiter.id}, '${recruiter.name}', '${recruiter.email}')">Editar</button>
              <button class="deleteButton" onclick="deleteRecruiter(${recruiter.id})">Deletar</button>
           `;

            recruitersList.appendChild(li);
          });
        })
        .catch(error => {
          console.error('Erro ao carregar recrutadores:', error);
        });
    }

    // Função para adicionar recrutador
    document.getElementById('addRecruiterForm').addEventListener('submit', event => {
      event.preventDefault();

      // Coleta os dados do formulário
      const formData = new FormData(event.target);
      const recruiterData = Object.fromEntries(formData.entries());

      // Verifica se todos os campos obrigatórios estão preenchidos
      if (!recruiterData.name || !recruiterData.email || !recruiterData.password) {
        alert('Por favor, preencha todos os campos obrigatórios.');
        return;
      }

      // Envia a requisição para adicionar o recrutador
      fetch('http://localhost:3000/recruiters', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ recruiter: recruiterData })
      })
        .then(response => response.json())
        .then(data => {
          if (data.token) {
            // Armazena o token no localStorage
            localStorage.setItem('token', data.token);
            alert('Recrutador adicionado com sucesso!');
            loadRecruiters(); // Recarrega a lista de recrutadores após adicionar um novo
          } else {
            return response.json();
          }
        })
        .catch(error => {
          console.error('Erro ao adicionar recrutador:', error.message);
          alert('Erro ao adicionar recrutador. Por favor, verifique os dados e tente novamente.');
        });
    });


    // Função para editar recrutador
    function editRecruiter(id, name, email) {
      const form = document.getElementById('editRecruiterForm');
      form.style.display = 'block'; // Exibe o formulário de edição
      form.elements['editName'].value = name; // Preenche o campo de nome com o valor atual
      form.elements['editEmail'].value = email; // Preenche o campo de email com o valor atual
      form.onsubmit = function (event) {
        event.preventDefault();
        const formData = new FormData(form);
        const newData = Object.fromEntries(formData.entries());
        updateRecruiter(id, newData);
      }
    }

    // Função para atualizar recrutador
    function updateRecruiter(id, newData) {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Você precisa estar logado para realizar essa ação.');
        return;
      }

      fetch(`http://localhost:3000/recruiters/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ recruiter: newData })
      })
        .then(response => {
          if (response.ok) {
            alert('Recrutador atualizado com sucesso!');
            loadRecruiters();
            cancelEdit(); // Esconde o formulário de edição após atualizar
          } else {
            throw new Error('Erro ao atualizar recrutador');
          }
        })
        .catch(error => {
          console.error('Erro ao atualizar recrutador:', error.message);
          alert('Erro ao atualizar recrutador. Por favor, tente novamente mais tarde.');
        });
    }

    // Função para cancelar edição
    function cancelEdit() {
      const form = document.getElementById('editRecruiterForm');
      form.style.display = 'none'; // Esconde o formulário de edição
    }




    // Função para deletar recrutador
    function deleteRecruiter(id) {
      const token = 'eyJhbGciOiJIUzI1NiJ9.eyJyZWNydWl0ZXJfaWQiOjUsImV4cCI6MTcxNzM0MjY5Nn0.gLh6PjgZtdRuiZOvnIkq88fWDpqs7OjkF8-dclAPXkU';

      fetch(`http://localhost:3000/recruiters/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
        .then(response => {
          if (response.ok) {
            alert('Recrutador excluído com sucesso!');
            loadRecruiters(); // Recarrega a lista de recrutadores após a exclusão
          } else {
            throw new Error('Erro ao excluir recrutador');
          }
        })
        .catch(error => {
          console.error('Erro ao excluir recrutador:', error.message);
          alert('Erro ao excluir recrutador. Por favor, tente novamente mais tarde.');
        });
    }


    // Carrega os recrutadores ao carregar a página
    loadRecruiters();

    // Função para carregar jobs
    function loadJobs() {
      fetch('http://localhost:3000/jobs')
        .then(response => response.json())
        .then(data => {
          const jobsList = document.getElementById('jobsList');
          jobsList.innerHTML = ''; // Limpa a lista anterior

          data.forEach(job => {
            const li = document.createElement('li');
            li.innerHTML = `
            ID: ${job.id} | Título: ${job.title} | Descrição: ${job.description} | Data de Início: ${job.start_date} | Data de Término: ${job.end_date} | Status: ${job.status} | Habilidades: ${job.skills} | ID do Recrutador: ${job.recruiter_id}
            <button class="deleteButton" onclick="deleteJob(${job.id})">Deletar</button>
          `;
            jobsList.appendChild(li);
          });
        })
        .catch(error => {
          console.error('Erro ao carregar jobs:', error);
        });
    }

    /*lista de jobs
    // Função para limpar a mensagem de erro
      function clearErrorMessage() {
      const errorMessageElement = document.getElementById('errorMessages');
      errorMessageElement.innerText = '';
    }*/
    // Função para adicionar job
    document.getElementById('addJobForm').addEventListener('submit', event => {
      event.preventDefault();

      const formData = new FormData(event.target);
      const jobData = Object.fromEntries(formData.entries());

      // Envia a requisição para adicionar o job sem o cabeçalho de autorização
      fetch('http://localhost:3000/jobs', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ job: jobData })
      })
        .then(response => {
          if (response.ok) {
            alert('Job adicionado com sucesso!');
            loadJobs();
          } else {
            throw new Error('Erro ao adicionar job');
          }
        })
        .then(data => {
          if (data && data.error) {
            // Exibe a mensagem de erro retornada pelo servidor
            document.getElementById('errorMessages').textContent = data.error;
          }
        })
        .catch(error => {
          console.error('Erro ao adicionar job:', error.message);
          const errorMessageElement = document.getElementById('errorMessages');
          errorMessageElement.innerText = 'Um usuario nao pode cadastrar duas vezes na mesma vaga ou o id do usuario não existe. Por favor revise seu pedido.';
        });

    });

    // Função para deletar job
    function deleteJob(id) {
      fetch(`http://localhost:3000/jobs/${id}`, {
        method: 'DELETE'
      })
        .then(response => {
          if (response.ok) {
            alert('Job excluído com sucesso!');
            loadJobs(); // Recarrega a lista de jobs após a exclusão
          } else {
            throw new Error('Erro ao excluir job');
          }
        })
        .catch(error => {
          console.error('Erro ao excluir job:', error.message);
          alert('Erro ao excluir job. Por favor, tente novamente mais tarde.');
        });
    }

    // Carrega os recrutadores ao carregar a página
    loadJobs();
  </script>
</body>

</html>